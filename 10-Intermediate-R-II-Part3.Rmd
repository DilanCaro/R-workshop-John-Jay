
# (Optional) Part V: Working with Dates and Times (20 minutes) {-}


## Handling date and time data in R {-}

R provides the Date class for dates and the POSIXct and POSIXlt classes for times.

```{r}
# Converting a string to a Date object
date_example <- as.Date("2021-01-01")
print(date_example)

# Converting a string to a POSIXct datetime object
datetime_example <- as.POSIXct("2021-01-01 10:00:00", tz = "GMT")
print(datetime_example)

```

## Common date and time functions {-}

```{r}

# Extracting parts of a date
year <- format(date_example, "%Y")
month <- format(date_example, "%m")
day <- format(date_example, "%d")
print(paste("Year:", year, "- Month:", month, "- Day:", day))

# Working with time intervals
start_time <- as.POSIXct("2021-01-01 08:00:00", tz = "GMT")
end_time <- as.POSIXct("2021-01-01 10:00:00", tz = "GMT")
time_diff <- difftime(end_time, start_time, units = "hours")
print(paste("Difference in hours:", time_diff))

# Loading a dataset with date and time data for exercises
# Using the 'airquality' dataset from the 'datasets' package
data(airquality)
airquality$Date <- as.Date(with(airquality, paste(1973, Month, Day, sep = "-")))
print(head(airquality))
```

Exercises:
```{r}
data(airquality)

airquality$Date <- as.Date(with(airquality, paste(1973, Month, Day, sep = "-")))
print(head(airquality))
```

1. Convert the 'Date' column in the 'airquality' dataset to a week day and create a new column 'WeekDay'.

```{r}
airquality$WeekDay <- weekdays(airquality$Date)
print(head(airquality))
```

2. Calculate the number of days between the first and last measurements in the 'airquality' dataset.

```{r}
date_diff <- difftime(max(airquality$Date), min(airquality$Date), units = "days")
print(paste("Days between first and last measurement:", date_diff))
```


## Working with dates and times

## Create and format dates

To create a Date object from a simple character string in R, you can use the as.Date() function. The character string has to obey a format that can be defined using a set of symbols (the examples correspond to 13 January, 1982):

`%Y`: 4-digit year (1982)
`%y`: 2-digit year (82)
`%m`: 2-digit month (01)
`%d`: 2-digit day of the month (13)
`%A`: weekday (Wednesday)
`%a`: abbreviated weekday (Wed)
`%B`: month (January)
`%b`: abbreviated month (Jan)

For more information and a full list use `?strptime`

## as.Date()

```{r}
as.Date('2019-06-05',format = '%Y-%m-%d')
```

Dates are often stored as integers.

Convert integers to dates by speciying the origin (Day 0).

For example: SAS stores dates at the number of days elapsed since 1 Jan 1960.

```{r}
as.Date(21705, origin = '1960-01-01')
```
## Exercise 1 {-}

Work with the policy_data data set.
1. Convert the start date (debut_pol) and end date (fin_pol) into R Date objects.

```{r}
library(dplyr)
policy_data <- read.csv(file = 'John Jay Workshop Data/PolicyData.csv', sep = ';')
policy_data$start <- as.Date(policy_data$debut_pol, '%d/%m/%Y')
policy_data$end <- as.Date(policy_data$fin_pol, '%d/%m/%Y')
head(policy_data %>% select(c('debut_pol', 'start')))
```

## format() {-}

```{r}
today <- as.Date('2019-06-05',
                format = '%Y-%m-%d')
format(today, '%A %d %B %Y')
```

Calculate the duration of a contract.

```{r}
policy_duration =
  policy_data$end - policy_data$start

```

You can add and subtract integers from dates.
```{r}
tomorrow = today + 1
print(tomorrow)
```

## Lubridate {-}

## Access date components
```{r}
# install.packages("lubridate")
library(lubridate)
```

```{r}
year(today)
```
Other components are: month(), day(), quarter(), ...

## Advanced math
```{r}
today + months(3)
```
Other periods are: years() and days().


```{r}
floor_date(today, unit = "month")
```
floor_date rounds down to the nearest unit. 

In the example convert daily into monthly data.

## seq() {-}

```{r}
seq(from = as.Date('2019-01-01'),
    to = as.Date('2019-12-31'),
    by = '1 month')
```

## Exercise 2 {-}

Visualize the exposure contribution by start month of the contract in the policy_data data set.
1. Add a covariate start_month to the data set. 2. Group the data by start_month.
3. Calculate the exposure within each group.
4. Plot the data.

